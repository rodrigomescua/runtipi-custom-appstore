{
  "$schema": "https://schemas.runtipi.io/v2/dynamic-compose.json",
  "schemaVersion": 2,
  "services": [
    {
      "name": "maxun-postgres",
      "image": "postgres:13",
      "environment": [
        {
          "key": "POSTGRES_USER",
          "value": "postgres"
        },
        {
          "key": "POSTGRES_PASSWORD",
          "value": "maxun"
        },
        {
          "key": "POSTGRES_DB",
          "value": "maxun"
        },
        {
          "key": "TZ",
          "value": "${TZ}"
        }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/postgres",
          "containerPath": "/var/lib/postgresql/data"
        }
      ],
      "healthCheck": {
        "test": "pg_isready -U postgres -d maxun",
        "interval": "10s",
        "timeout": "5s",
        "retries": 5
      }
    },
    {
      "name": "maxun-minio",
      "image": "minio/minio",
      "environment": [
        {
          "key": "MINIO_ROOT_USER",
          "value": "maxun_minio_user"
        },
        {
          "key": "MINIO_ROOT_PASSWORD",
          "value": "maxun_minio_secret_2024"
        },
        {
          "key": "TZ",
          "value": "${TZ}"
        }
      ],
      "command": ["server", "/data", "--console-address", ":9001"],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/minio",
          "containerPath": "/data"
        }
      ],
      "addPorts": [
        {
          "hostPort": 9000,
          "containerPort": 9000
        },
        {
          "hostPort": 9001,
          "containerPort": 9001
        }
      ]
    },
    {
      "name": "maxun-backend",
      "image": "getmaxun/maxun-backend:v0.0.35",
      "environment": [
        {
          "key": "BACKEND_URL",
          "value": "http://${APP_PORT}:8837"
        },
        {
          "key": "PLAYWRIGHT_BROWSERS_PATH",
          "value": "/ms-playwright"
        },
        {
          "key": "PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD",
          "value": "0"
        },
        {
          "key": "CONTAINER",
          "value": "true"
        },
        {
          "key": "CI",
          "value": "true"
        },
        {
          "key": "CHROMIUM_FLAGS",
          "value": "--disable-gpu --no-sandbox --headless=new"
        },
        {
          "key": "NODE_ENV",
          "value": "production"
        },
        {
          "key": "JWT_SECRET",
          "value": "maxun_jwt_secret_key_2024_very_secure_token_for_authentication"
        },
        {
          "key": "DB_NAME",
          "value": "maxun"
        },
        {
          "key": "DB_USER",
          "value": "postgres"
        },
        {
          "key": "DB_PASSWORD",
          "value": "maxun"
        },
        {
          "key": "DB_HOST",
          "value": "maxun-postgres"
        },
        {
          "key": "DB_PORT",
          "value": "5432"
        },
        {
          "key": "ENCRYPTION_KEY",
          "value": "a1b2c3d4e5f6789012345678901234567890123456789012345678901234567890"
        },
        {
          "key": "SESSION_SECRET",
          "value": "maxun_session_secret_2024_secure"
        },
        {
          "key": "MINIO_ENDPOINT",
          "value": "maxun-minio"
        },
        {
          "key": "MINIO_PORT",
          "value": "9000"
        },
        {
          "key": "MINIO_CONSOLE_PORT",
          "value": "9001"
        },
        {
          "key": "MINIO_ACCESS_KEY",
          "value": "maxun_minio_user"
        },
        {
          "key": "MINIO_SECRET_KEY",
          "value": "maxun_minio_secret_2024"
        },
        {
          "key": "BACKEND_PORT",
          "value": "8080"
        },
        {
          "key": "FRONTEND_PORT",
          "value": "5173"
        },
        {
          "key": "PUBLIC_URL",
          "value": "http://${INTERNAL_IP}:${APP_PORT}"
        },
        {
          "key": "VITE_BACKEND_URL",
          "value": "http://${INTERNAL_IP}:8837"
        },
        {
          "key": "VITE_PUBLIC_URL",
          "value": "http://${INTERNAL_IP}:${APP_PORT}"
        },
        {
          "key": "MAXUN_TELEMETRY",
          "value": "true"
        },
        {
          "key": "GOOGLE_CLIENT_ID",
          "value": "${GOOGLE_CLIENT_ID}"
        },
        {
          "key": "GOOGLE_CLIENT_SECRET",
          "value": "${GOOGLE_CLIENT_SECRET}"
        },
        {
          "key": "GOOGLE_REDIRECT_URI",
          "value": "http://localhost:8080/auth/google/callback"
        },
        {
          "key": "AIRTABLE_CLIENT_ID",
          "value": "${AIRTABLE_CLIENT_ID}"
        },
        {
          "key": "AIRTABLE_REDIRECT_URI",
          "value": "http://localhost:8080/auth/airtable/callback"
        },
        {
          "key": "TZ",
          "value": "${TZ}"
        }
      ],
      "dependsOn": {
        "maxun-postgres": {
          "condition": "service_started"
        },
        "maxun-minio": {
          "condition": "service_started"
        }
      },
      "volumes": [
        {
          "hostPath": "/var/run/dbus",
          "containerPath": "/var/run/dbus"
        }
      ],
      "addPorts": [
        {
          "hostPort": 8837,
          "containerPort": 8080
        }
      ]
    },
    {
      "name": "maxun-frontend",
      "image": "getmaxun/maxun-frontend:v0.0.31",
      "environment": [
        {
          "key": "PUBLIC_URL",
          "value": "http://${INTERNAL_IP}:${APP_PORT}"
        },
        {
          "key": "BACKEND_URL",
          "value": "http://${INTERNAL_IP}:8837"
        },
        {
          "key": "VITE_BACKEND_URL",
          "value": "http://${INTERNAL_IP}:8837"
        },
        {
          "key": "VITE_PUBLIC_URL",
          "value": "http://${INTERNAL_IP}:${APP_PORT}"
        },
        {
          "key": "FRONTEND_PORT",
          "value": "5173"
        },
        {
          "key": "TZ",
          "value": "${TZ}"
        }
      ],
      "internalPort": 5173,
      "isMain": true,
      "dependsOn": {
        "maxun-backend": {
          "condition": "service_started"
        }
      }
    }
  ]
}
