{
  "services": [
    {
      "name": "maxun-postgres",
      "image": "postgres:13",
      "environment": {
        "POSTGRES_USER": "postgres",
        "POSTGRES_PASSWORD": "maxun",
        "POSTGRES_DB": "maxun",
        "TZ": "${TZ}"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/postgres",
          "containerPath": "/var/lib/postgresql/data"
        }
      ],
      "restart": "unless-stopped",
      "healthCheck": {
        "test": "pg_isready -U postgres",
        "interval": "10s",
        "timeout": "5s",
        "retries": 5
      }
    },
    {
      "name": "maxun-minio",
      "image": "minio/minio",
      "environment": {
        "MINIO_ROOT_USER": "maxun_minio_user",
        "MINIO_ROOT_PASSWORD": "maxun_minio_secret_2024",
        "TZ": "${TZ}"
      },
      "command": ["server", "/data", "--console-address", ":9001"],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/minio",
          "containerPath": "/data"
        }
      ],
      "restart": "unless-stopped",
      "addPorts": [
        {
          "hostPort": 9000,
          "containerPort": 9000
        },
        {
          "hostPort": 9001,
          "containerPort": 9001
        }
      ]
    },
    {
      "name": "maxun-backend",
      "image": "getmaxun/maxun-backend:latest",
      "environment": {
        "BACKEND_URL": "http://localhost:8080",
        "PLAYWRIGHT_BROWSERS_PATH": "/ms-playwright",
        "PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD": "0",
        "CONTAINER": "true",
        "CI": "true",
        "CHROMIUM_FLAGS": "--disable-gpu --no-sandbox --headless=new",
        "NODE_ENV": "production",
        "JWT_SECRET": "maxun_jwt_secret_key_2024_very_secure_token_for_authentication",
        "DB_NAME": "maxun",
        "DB_USER": "postgres",
        "DB_PASSWORD": "maxun",
        "DB_HOST": "maxun-postgres",
        "DB_PORT": "5432",
        "ENCRYPTION_KEY": "a1b2c3d4e5f6789012345678901234567890123456789012345678901234567890",
        "SESSION_SECRET": "maxun_session_secret_2024_secure",
        "MINIO_ENDPOINT": "maxun-minio",
        "MINIO_PORT": "9000",
        "MINIO_CONSOLE_PORT": "9001",
        "MINIO_ACCESS_KEY": "maxun_minio_user",
        "MINIO_SECRET_KEY": "maxun_minio_secret_2024",
        "BACKEND_PORT": "8080",
        "FRONTEND_PORT": "5173",
        "PUBLIC_URL": "http://localhost:5173",
        "VITE_BACKEND_URL": "http://localhost:8080",
        "VITE_PUBLIC_URL": "http://localhost:5173",
        "MAXUN_TELEMETRY": "true",
        "GOOGLE_CLIENT_ID": "${GOOGLE_CLIENT_ID}",
        "GOOGLE_CLIENT_SECRET": "${GOOGLE_CLIENT_SECRET}",
        "GOOGLE_REDIRECT_URI": "http://localhost:8080/auth/google/callback",
        "AIRTABLE_CLIENT_ID": "${AIRTABLE_CLIENT_ID}",
        "AIRTABLE_REDIRECT_URI": "http://localhost:8080/auth/airtable/callback",
        "TZ": "${TZ}"
      },
      "restart": "unless-stopped",
      "securityOpt": ["seccomp=unconfined"],
      "shmSize": "2gb",
      "memLimit": "2g",
      "dependsOn": ["maxun-postgres", "maxun-minio"],
      "volumes": [
        {
          "hostPath": "/var/run/dbus",
          "containerPath": "/var/run/dbus"
        }
      ],
      "addPorts": [
        {
          "hostPort": 8080,
          "containerPort": 8080
        }
      ]
    },
    {
      "name": "maxun-frontend",
      "image": "getmaxun/maxun-frontend:latest",
      "environment": {
        "PUBLIC_URL": "http://localhost:5173",
        "BACKEND_URL": "http://localhost:8080",
        "VITE_BACKEND_URL": "http://localhost:8080",
        "VITE_PUBLIC_URL": "http://localhost:5173",
        "TZ": "${TZ}"
      },
      "restart": "unless-stopped",
      "internalPort": 5173,
      "isMain": true,
      "dependsOn": ["maxun-backend"]
    }
  ]
}