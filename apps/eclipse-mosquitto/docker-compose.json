{
  "$schema": "https://schemas.runtipi.io/v2/dynamic-compose.json",
  "schemaVersion": 2,
  "services": [
    {
      "name": "eclipse-mosquitto",
      "image": "eclipse-mosquitto:2.0.22",
      "isMain": true,
      "internalPort": 1883,
      "command": ["/dynsec-setup.sh", "/usr/sbin/mosquitto", "-c", "/mosquitto/config/mosquitto.conf"],
      "environment": [
        {
          "key": "TZ",
          "value": "${TZ}"
        },
        {
          "key": "MQTT_DYNSEC_ADMIN_USER",
          "value": "admin"
        },
        {
          "key": "MQTT_DYNSEC_ADMIN_PASSWORD",
          "value": "${MQTT_ADMIN_PASSWORD}"
        }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/data",
          "containerPath": "/mosquitto/data"
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/config",
          "containerPath": "/mosquitto/config"
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/scripts/dynsec-setup.sh",
          "containerPath": "/dynsec-setup.sh"
        }
      ]
    },
    {
      "name": "mosquitto-management-center",
      "image": "cedalo/management-center:2",
      "environment": [
        {
          "key": "TZ",
          "value": "${TZ}"
        },
        {
          "key": "CEDALO_MC_BROKER_ID",
          "value": "mosquitto-broker"
        },
        {
          "key": "CEDALO_MC_BROKER_NAME",
          "value": "mosquitto-broker-2"
        },
        {
          "key": "CEDALO_MC_BROKER_URL",
          "value": "mqtt://eclipse-mosquitto:1883"
        },
        {
          "key": "CEDALO_MC_BROKER_USERNAME",
          "value": "admin"
        },
        {
          "key": "CEDALO_MC_BROKER_PASSWORD",
          "value": "${MQTT_ADMIN_PASSWORD}"
        },
        {
          "key": "CEDALO_MC_USERNAME",
          "value": "admin"
        },
        {
          "key": "CEDALO_MC_PASSWORD",
          "value": "${CEDALO_MC_PASSWORD}"
        }
      ],
      "dependsOn": {
        "eclipse-mosquitto": {
          "condition": "service_started"
        }
      },
      "addPorts": [
        {
          "hostPort": 8288,
          "containerPort": 8088
        }
      ]
    }
  ]
}
