{
  "$schema": "https://schemas.runtipi.io/v2/dynamic-compose.json",
  "schemaVersion": 2,
  "services": [
    {
      "name": "colanode-postgres",
      "image": "pgvector/pgvector:pg17",
      "environment": [
        {
          "key": "POSTGRES_USER",
          "value": "colanode_user"
        },
        {
          "key": "POSTGRES_PASSWORD",
          "value": "postgrespass123"
        },
        {
          "key": "POSTGRES_DB",
          "value": "colanode_db"
        }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/postgres_data",
          "containerPath": "/var/lib/postgresql/data"
        }
      ]
    },
    {
      "name": "colanode-valkey",
      "image": "valkey/valkey:8.1",
      "command": [
        "valkey-server",
        "--requirepass",
        "your_valkey_password"
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/valkey_data",
          "containerPath": "/data"
        }
      ]
    },
    {
      "name": "colanode-minio",
      "image": "minio/minio:RELEASE.2025-04-08T15-41-24Z",
      "command": ["sh", "-c", "mkdir -p /data/colanode && minio server /data --address \":9000\" --console-address \":9001\""],
      "environment": [
        {
          "key": "MINIO_ROOT_USER",
          "value": "minioadmin"
        },
        {
          "key": "MINIO_ROOT_PASSWORD",
          "value": "your_minio_password"
        },
        {
          "key": "MINIO_BROWSER",
          "value": "on"
        },
        {
          "key": "MINIO_DOMAIN",
          "value": "minio"
        },
        {
          "key": "MINIO_ADDRESS",
          "value": ":9000"
        },
        {
          "key": "MINIO_CONSOLE_ADDRESS",
          "value": ":9001"
        }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/minio_data",
          "containerPath": "/data"
        }
      ],
      "addPorts": [
        {
          "hostPort": 9001,
          "containerPort": 9001
        }
      ]
    },
    {
      "name": "colanode-server",
      "image": "ghcr.io/colanode/server:0.3.4",
      "environment": [
        {
          "key": "NODE_ENV",
          "value": "production"
        },
        {
          "key": "SERVER_NAME",
          "value": "Colanode Local"
        },
        {
          "key": "SERVER_AVATAR",
          "value": "default-avatar"
        },
        {
          "key": "SERVER_MODE",
          "value": "standalone"
        },
        {
          "key": "ACCOUNT_VERIFICATION_TYPE",
          "value": "automatic"
        },
        {
          "key": "ACCOUNT_OTP_TIMEOUT",
          "value": "600"
        },
        {
          "key": "USER_STORAGE_LIMIT",
          "value": "10737418240"
        },
        {
          "key": "USER_MAX_FILE_SIZE",
          "value": "104857600"
        },
        {
          "key": "POSTGRES_URL",
          "value": "postgres://colanode_user:postgrespass123@colanode-postgres:5432/colanode_db"
        },
        {
          "key": "REDIS_URL",
          "value": "redis://:your_valkey_password@colanode-valkey:6379/0"
        },
        {
          "key": "REDIS_DB",
          "value": "0"
        },
        {
          "key": "STORAGE_S3_ENDPOINT",
          "value": "http://colanode-minio:9000"
        },
        {
          "key": "STORAGE_S3_ACCESS_KEY",
          "value": "minioadmin"
        },
        {
          "key": "STORAGE_S3_SECRET_KEY",
          "value": "your_minio_password"
        },
        {
          "key": "STORAGE_S3_BUCKET",
          "value": "colanode"
        },
        {
          "key": "STORAGE_S3_REGION",
          "value": "us-east-1"
        },
        {
          "key": "STORAGE_S3_FORCE_PATH_STYLE",
          "value": "true"
        },
        {
          "key": "SMTP_ENABLED",
          "value": "false"
        },
        {
          "key": "SERVER_CORS_ORIGIN",
          "value": "https://${APP_DOMAIN}"
        }
      ],
      "internalPort": 3000,
      "addPorts": [
        {
          "hostPort": 8834,
          "containerPort": 3000
        }
      ],
      "dependsOn": {
        "colanode-postgres": {
          "condition": "service_started"
        },
        "colanode-valkey": {
          "condition": "service_started"
        },
        "colanode-minio": {
          "condition": "service_started"
        }
      }
    },
    {
      "name": "colanode-web",
      "image": "ghcr.io/colanode/web:0.3.4",
      "internalPort": 80,
      "isMain": true,
      "dependsOn": {
        "colanode-server": {
          "condition": "service_started"
        }
      }
    }
  ]
}
