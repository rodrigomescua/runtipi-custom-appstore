{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "automerge": false,
  "prHourlyLimit": 20,
  "extends": [
    "config:recommended"
  ],
  "addLabels": [
    "renovate"
  ],
  "enabledManagers": ["custom.regex"],
  "automergeStrategy": "rebase",
  "prCreation": "immediate",
  "rebaseWhen": "conflicted",
  "customManagers": [
    {
      "customType": "regex",
      "managerFilePatterns": ["/^apps\/.+\/docker-compose\\.json$/"],
      "matchStrings": [
        "\"image\": \"(?<depName>.*?):(?<currentValue>.*?)\","
      ],
      "datasourceTemplate": "docker"
    }
  ],
  "packageRules": [
    {
      "matchUpdateTypes": [
        "minor",
        "major",
        "patch",
        "pin",
        "digest"
      ],
      "automerge": false
    },
    {
      "matchDepTypes": [
        "devDependencies"
      ],
      "automerge": false
    },
    {
      "matchPackageNames": [
        "mariadb",
        "mysql",
        "mongo",
        "mongodb",
        "postgres",
        "postgis/postgis",
        "redis",
        "rabbitmq",
        "milvusdb/milvus",
        "minio/minio",
        "quay.io/coreos/etcd"
      ],
      "enabled": false
    },
    {
      "matchPackagePatterns": [
        ".*-etcd$",
        ".*-minio$",
        ".*-redis$"
      ],
      "enabled": false
    },
    {
      "description": "Group all updates for the same app into a single PR",
      "matchFileNames": ["apps/**"],
      "groupName": "{{parentDir}}"
    }
  ],
  "postUpgradeTasks": {
    "commands": [
      "bun install",
      "bun ./scripts/update-config.ts {{packageFile}} {{newVersion}} {{packageName}}",
      "bun run test"
    ],
    "fileFilters": [
      "**/*"
    ],
    "executionMode": "update"
  }
}
